# FaxRetriever 2.0 — Unified Schema Definitions (v2.0)

This document defines all runtime, configuration, and storage schemas used in the FaxRetriever system. It is divided into:

- **Section 1: Server (FRA)**
- **Section 2: Client (FR)**

---

## SECTION 1 — SERVER (FRA)
### 1.1 `resellers` Collection (MongoDB)
```json
{
  "reseller_id": "12345",
  "reseller_blob": "<AES-GCM payload>",
  "contact_name": "Pharmacy Solutions Group",
  "contact_email": "admin@example.com",
  "contact_phone": "+14055550123",
  "note": "Beta onboarding group",
  "bearer_token_present": true,
  "bearer_token_last_issued": "2025-08-01T03:01:44Z",
  "bearer_token_expires_at": "2025-08-02T02:59:59Z"
}
```
---
### 1.2 `clients` collection (MongoDB)
```json
{
  "fax_user": "100@clientdomain.12345.service",
  "authentication_token": "12345-67890",
  "domain_uuid": "d7c94c29-8eb0-4bb2-a7c3-b6d3db8a19ef",
  "all_fax_numbers": ["+14055551234", "+14055554321"],
  "reseller_id": "12345",
"retriever_assignments": {
  "+14055551234": "DESKTOP-1234ABCD",
  "+14055554321": "DESKTOP-5678WXYZ"
},
  "active": true
}
```
---
### 1.3 `/init`
## Query Schema
```json
{
  "fax_user": "100@clientdomain.12345.service",
  "authentication_token": "12345-67890",
  "device_id": "DESKTOP-1234ABCD"
}
```
## Response Schema

```json
{
  "jwt_token": "<JWT>",
  "domain_uuid": "d7c94c29-8eb0-4bb2-a7c3-b6d3db8a19ef",
}
```
---
### 1.4 `/bearer` 
## Query Schema
```json
  ""
```
## Response Schema
```json
{
  "bearer_token": "Bearer eyJhbGciOi...",
  "bearer_token_retrieved": "2025-08-02T01:03:00Z",
  "bearer_token_expires_at": "2025-08-03T00:59:00Z"
}
```
### 1.5 `/assignments` Response Schema
```json
{
  "retriever_assignments": {
    "+14055551234": "DESKTOP-1234ABCD",
    "+14055554321": "DESKTOP-5678WXYZ",
    "+14055559812": ""
  }
}
```
### 1.5 `access_logs` Collection (90-day TTL)
```json
{
  "timestamp": "2025-08-02T01:05:45Z",
  "event_type": "init_request",
  "domain_uuid": "d7c94c29-8eb0-4bb2-a7c3-b6d3db8a19ef",
  "device_id": "DESKTOP-1234ABCD",
  "actor": {
    "component": "FR",
    "function": "post_init",
    "request_id": "req-90238"
  },
  "object": {
    "type": "jwt",
    "operation": "issued",
    "payload": "..."
  },
  "note": "Initial token issued"
}
```
### 1.6 `audit_logs` Collection (365-day TTL)
```json
{
  "timestamp": "2025-08-01T20:44:13Z",
  "event_type": "retriever_reassigned",
  "domain_uuid": "d7c94c29-8eb0-4bb2-a7c3-b6d3db8a19ef",
  "device_id": "DESKTOP-5678WXYZ",
  "actor": {
    "component": "AdminGUI",
    "function": "reassignRetriever",
    "request_id": "req-88221"
  },
  "object": {
    "type": "retriever",
    "operation": "update",
    "payload": {
      "old_device_id": "DESKTOP-1234ABCD",
      "new_device_id": "DESKTOP-5678WXYZ"
    }
  },
  "note": "Retriever manually reassigned"
}
```

## Section 2 - CLIENT (FR)

### 2.1 Client Init Request Payload
```json
{
  "fax_user": "100@clientdomain.12345.service",
  "authentication_token": "12345-67890"
}
```
### 2.2 Global Config File (./shared/config/config.json)
```json
{
  "version": "2.0",
  "fax_user": "100@clientdomain.12345.service",
  "authentication_token": "12345-67890",
  "domain_uuid": "d7c94c29-8eb0-4bb2-a7c3-b6d3db8a19ef",
  "validation_status": true,
  "retriever_mode": "sender_receiver",
  "retriever_status": "allowed",
  "jwt_token": "<JWT>",
  "bearer_token": "Bearer eyJhbGciOi...",
  "bearer_token_retrieved": "2025-08-02T01:03:00Z",
  "bearer_token_expires_at": "2025-08-03T00:59:00Z",
  "all_fax_numbers": ["+14055551234", "+14055552345", "+14055553456", "+14055554567"],
  "integration_settings": {
    "enable_third_party": false,
    "integration_software": null
  }
}
```
### 2.3 User Config File (%LOCALAPPDATA%/Clinic Networking, LLC/FaxRetriever/config.json)
```json
{
  "retriever_mode": "sender_receiver",
  "selected_fax_number": "+14055551234",
  "download_method": "pdf",
  "file_name_format": "timestamp_faxnumber",
  "polling_frequency": 60,
  "print_faxes": false,
  "delete_faxes": true,
  "archive_enabled": true,
  "archive_duration": 30
}
```
### 2.4 JWT Claims (Client-Scoped)
```json
{
  "domain_uuid": "d7c94c29-8eb0-4bb2-a7c3-b6d3db8a19ef",
  "device_id": "DESKTOP-1234ABCD",
  "iat": 1722567600,
  "exp": 1722654000
}

```
